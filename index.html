<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Classroom Basketball</title>
  <style>
    body { margin:0; background:#eee; }
    canvas { background:#cce0ff; display:block; margin:auto; }
  </style>
</head>
<body>
<canvas id="game" width="900" height="500"></canvas>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let keys = {};
document.addEventListener("keydown", e => keys[e.code] = true);
document.addEventListener("keyup", e => keys[e.code] = false);

class Player {
  constructor(x, color, isBot=false) {
    this.x = x;
    this.y = 400;
    this.vx = 0;
    this.vy = 0;
    this.width = 40;
    this.height = 80;
    this.color = color;
    this.onGround = true;
    this.isBot = isBot;
    this.holdingBall = false;
    this.charge = 0;
  }
  update() {
    if (!this.isBot) {
      if (keys["ArrowLeft"] || keys["KeyA"]) this.vx = -4;
      else if (keys["ArrowRight"] || keys["KeyD"]) this.vx = 4;
      else this.vx = 0;

      if ((keys["ArrowUp"] || keys["KeyW"] || keys["Space"]) && this.onGround) {
        this.vy = -10;
        this.onGround = false;
      }

      if (keys["ArrowDown"] || keys["KeyS"]) this.height = 60;
      else this.height = 80;

      if (this.holdingBall && keys["Space"]) {
        this.charge = Math.min(this.charge + 0.2, 10);
      } else if (this.holdingBall && this.charge > 0) {
        ball.holder = null;
        ball.vx = this.charge * 2;
        ball.vy = -this.charge;
        ball.x = this.x + this.width;
        ball.y = this.y;
        this.charge = 0;
        this.holdingBall = false;
      }
    } else {
      if (!this.holdingBall) {
        if (ball.x < this.x) this.vx = -2;
        else if (ball.x > this.x) this.vx = 2;
        else this.vx = 0;
      } else {
        this.charge += 0.2;
        if (this.charge >= 5) {
          ball.holder = null;
          ball.vx = this.charge * 2;
          ball.vy = -this.charge;
          ball.x = this.x + this.width;
          ball.y = this.y;
          this.charge = 0;
          this.holdingBall = false;
        }
      }
    }

    this.vy += 0.5;
    this.y += this.vy;
    if (this.y >= 400) {
      this.y = 400;
      this.vy = 0;
      this.onGround = true;
    }

    this.x += this.vx;
    if (this.x < 0) this.x = 0;
    if (this.x + this.width > canvas.width) this.x = canvas.width - this.width;

    if (!ball.holder &&
        ball.x < this.x + this.width &&
        ball.x + ball.size > this.x &&
        ball.y < this.y + this.height &&
        ball.y + ball.size > this.y) {
      this.holdingBall = true;
      ball.holder = this;
    }
  }
  draw() {
    ctx.fillStyle = this.color;
    ctx.fillRect(this.x, this.y, this.width, this.height);
    if (this.charge > 0) {
      ctx.strokeStyle = "black";
      ctx.beginPath();
      ctx.moveTo(this.x+this.width/2, this.y);
      ctx.lineTo(this.x+this.width/2 + this.charge*10, this.y - this.charge*5);
      ctx.stroke();
    }
  }
}

class Ball {
  constructor() {
    this.x = 200;
    this.y = 200;
    this.vx = 0;
    this.vy = 0;
    this.size = 20;
    this.holder = null;
  }
  update() {
    if (this.holder) {
      this.x = this.holder.x + this.holder.width/2 - this.size/2;
      this.y = this.holder.y - this.size;
    } else {
      this.vy += 0.5;
      this.x += this.vx;
      this.y += this.vy;

      if (this.y + this.size > 480) {
        this.y = 480 - this.size;
        this.vy *= -0.5;
        this.vx *= 0.7;
      }

      if (this.x < 0 || this.x + this.size > canvas.width) {
        this.vx *= -0.5;
      }

      if (this.x > canvas.width) {
        this.reset();
      }
    }

    // --- AUTO AIM HOOP CHECK ---
    if (this.x + this.size/2 > 840 && this.x + this.size/2 < 880 &&
        this.y + this.size/2 > 340 && this.y + this.size/2 < 380) {
      scorePoint(this.holder ? this.holder : lastShooter);
      this.reset();
    }
  }
  reset() {
    this.x = 450;
    this.y = 200;
    this.vx = 0;
    this.vy = 0;
    this.holder = null;
  }
  draw() {
    ctx.fillStyle = "white";
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.size/2, 0, Math.PI*2);
    ctx.fill();
    ctx.strokeStyle = "gray";
    ctx.stroke();
  }
}

let player = new Player(100, "blue");
let bot = new Player(300, "red", true);
let ball = new Ball();

let scores = { player:0, bot:0 };
let lastShooter = null;

function scorePoint(who) {
  if (who === player) scores.player++;
  else if (who === bot) scores.bot++;
  lastShooter = who;
  if (scores.player >= 7 || scores.bot >= 7) {
    alert((scores.player>=7 ? "You win!" : "Bot wins!") + " Refresh to play again.");
  }
}

function drawCourt() {
  ctx.fillStyle = "#ffe4b5";
  ctx.fillRect(0, 480, canvas.width, 20);

  ctx.fillStyle = "gray";
  ctx.fillRect(840, 340, 40, 40); // trash can
  ctx.fillStyle = "#deb887";
  ctx.fillRect(820, 380, 80, 20); // table
}

function loop() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  drawCourt();

  player.update();
  bot.update();
  ball.update();

  player.draw();
  bot.draw();
  ball.draw();

  ctx.fillStyle = "black";
  ctx.fillText("Player: " + scores.player, 20, 20);
  ctx.fillText("Bot: " + scores.bot, 20, 40);

  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
